var SydneyExternalSerpResources;(function(){function u(u){var h,c,l,a,v,y,p,e=JSON.parse(u),s,w,k,d;if(e&&e.answerType==="ads"){if(!e.fetchUrl||!(e.fetchUrl.startsWith("/BingChatAdsFetch")||e.fetchUrl.startsWith("/turing/BingChatAdsFetch"))){SydFSCHelper.SydLog("AdsAjax","BingChatAds","RenderChatAdsCallFailed",{Reason:"Invalid fetch URL sent from client"});return}if(_w.ifidmap){if(_w.ifidmap.includes(e.iframeId)){SydFSCHelper.SydLog("AdsAjax","BingChatAds","RenderChatAdsCallFailed",{Reason:"Ad already requested for iframeId"});return}_w.ifidmap.push(e.iframeId)}else _w.ifidmap=[e.iframeId];s=e.fetchUrl.startsWith("/turing/BingChatAdsFetch")?e.fetchUrl:"/turing"+e.fetchUrl;w=SydFSCHelper.getConfigOrDefault((h=_w._sydConvConfig)===null||h===void 0?void 0:h.isUnderside,!1);w&&(s="/edgesvc"+s);var o=new URL(s,_w.location.origin),b=(l=(c=o===null||o===void 0?void 0:o.searchParams)===null||c===void 0?void 0:c.get(t))!==null&&l!==void 0?l:"",g=(v=(a=o===null||o===void 0?void 0:o.searchParams)===null||a===void 0?void 0:a.get(i))!==null&&v!==void 0?v:"",nt=SydFSCHelper.getConfigOrDefault((y=_w._sydConvConfig)===null||y===void 0?void 0:y.isVisualParityRun,!1);if(b===""&&!nt){SydFSCHelper.SydLog("AdsAjax","BingChatAds","Could not parse query from request");return}if(o.searchParams["delete"](t),o.searchParams["delete"](i),k=(p=e.conversationHistory)!==null&&p!==void 0?p:[],d="".concat(t,"=").concat(encodeURIComponent(b),"&").concat(i,"=").concat(encodeURIComponent(g),"&").concat(r,"=").concat(encodeURIComponent(JSON.stringify(k))),s=o.pathname+o.search,!e.singleSlotName){SydFSCHelper.SydLog("AdsAjax","BingChatAds","RenderChatAdsCallFailed",{Reason:"SingleSlotName not set"});return}if(!e.adsFrameSource){SydFSCHelper.SydLog("AdsAjax","BingChatAds","No client source to attach ads to from client");return}function tt(t,i){var r,u,f,s;if(t&&n!==null&&i){if(i.appendTo(n),!n.children||n.children.length===0){SydFSCHelper.SydLog("AdsAjax","BingChatAds","No ads in response to process");return}s=(f=(u=(r=o.searchParams)===null||r===void 0?void 0:r.get("codex_src"))===null||u===void 0?void 0:u.includes("semanticserp"))!==null&&f!==void 0?f:!1;SydFSCHelper.injectExternalAd(e.adsFrameSource,e.iframeId,s)&&SydFSCHelper.SydLog("AdsAjax","BingChatAds","Injection Succeeded")}else SydFSCHelper.SydLog("AdsAjax","BingChatAds","InjectionFailed",{Reason:"Ajax call did not return a success code",Url:o})}f(s,d,{callback:tt,headers:{"chat-single-slot-name":e.singleSlotName}})}else SydFSCHelper.SydLog("AdsAjax","BingChatAds","RenderChatAdsCallFailed",{Reason:"Invalid JSON from client or event is not of type 'Ads'"})}function f(n,t,i){function l(){r[e]=c;r.abort&&r.abort()}function h(n,t){typeof n=="function"&&n(t,{request:r,appendTo:function(n){r&&typeof sj_appHTML!="undefined"&&sj_appHTML(n,r.responseText)}})}var u,r=sj_gx(),e="onreadystatechange",f,o=null,s,a=sb_st,v=sb_ct,c=function(){};if(!n||!r){h(u,!1);return}r.open("post",n,!0);r.setRequestHeader("Content-type","application/x-www-form-urlencoded");i&&(u=i.callback,f=i.timeout,s=i.headers,Object.keys(s||{}).forEach(function(n){r.setRequestHeader(n,s[n])}),i.withCredentials!==undefined&&(r.withCredentials=i.withCredentials));r[e]=function(){if(r.readyState===4){var n=!1;o!==null&&v(o);r.status===200&&(n=!0,r[e]=c);h(u,n)}};sj_evt.bind("ajax.unload",l);r.send(t);f&&f>0&&(o=a(function(){l();h(u,!1)},f))}function e(){n=_d.getElementById("b_chat_external_content");_w._sydExtRes=u}var n,t="q",i="codex_summ",r="codex_hist";e()})(SydneyExternalSerpResources||(SydneyExternalSerpResources={}))